@using Microsoft.AspNetCore.Components.Routing
@inject IJSRuntime JSRuntime

<CascadingValue Value="this">

    <MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme" />
    <MudDialogProvider />
    <MudSnackbarProvider />
    <MudPopoverProvider />

    <PageTransition />

    <Router AppAssembly="@typeof(App).Assembly">

        <Found Context="routeData">
            <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>

        <NotFound>
            <PageTitle>Not found</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <MudContainer Class="mt-6">
                    <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">Page not found</MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        Sorry, there's nothing at this address.
                    </MudText>
                    <MudContainer Class="d-flex justify-center mt-4">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/">Go Home</MudButton>
                    </MudContainer>
                </MudContainer>
            </LayoutView>
        </NotFound>

    </Router>

</CascadingValue>

@code
{
    private bool _isDarkMode = true; // Set dark mode as default

    // Theme with the dark navy background from your image
    private MudTheme _theme = new MudTheme()
    {
        Palette = new PaletteLight()
        {
            // Light mode palette
            Primary = "#0EA5E9", // sky-500
            Secondary = "#6366F1", // indigo-500
            Background = "#F1F5F9", // slate-100
            Surface = "#FFFFFF", // white
            AppbarBackground = "#0EA5E9", // sky-500
            DrawerBackground = "#FFFFFF", // white
            DrawerText = "#475569", // slate-600
            Success = "#10B981", // emerald-500
            Warning = "#F59E0B", // amber-500
            Error = "#EF4444", // red-500
            Dark = "#1E293B", // slate-800
            TextPrimary = "#1E293B", // slate-800
            TextSecondary = "#475569", // slate-600
            Info = "#3B82F6", // blue-500
        },
        PaletteDark = new PaletteDark()
        {
            // Dark mode palette with your specific navy color
            Primary = "#38BDF8", // sky-400
            Secondary = "#818CF8", // indigo-400
            Background = "#020617", // The dark navy from your image (close to slate-950)
            Surface = "#030712", // Slightly lighter for surface elements
            AppbarBackground = "#020617", // Same dark navy
            DrawerBackground = "#020617", // Same dark navy
            DrawerText = "#E2E8F0", // slate-200
            Success = "#34D399", // emerald-400
            Warning = "#FBBF24", // amber-400
            Error = "#F87171", // red-400
            Info = "#60A5FA", // blue-400
            Dark = "#F8FAFC", // slate-50
            TextPrimary = "#F8FAFC", // slate-50
            TextSecondary = "#E2E8F0", // slate-200
        },
        Typography = new Typography()
        {
            Default = new Default()
            {
                FontFamily = new[] { "Inter", "ui-sans-serif", "system-ui", "sans-serif" }
            }
        }
    };

    protected override async Task OnInitializedAsync()
    {
        // Load theme preference from localStorage
        var storedTheme = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "portfolioTheme");
        if (!string.IsNullOrEmpty(storedTheme))
        {
            _isDarkMode = storedTheme == "dark";
        }
    }

    public async void ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
        // Save theme preference to localStorage
        await JSRuntime.InvokeVoidAsync("localStorage.setItem", "portfolioTheme", _isDarkMode ? "dark" : "light");
        StateHasChanged();
    }
}
